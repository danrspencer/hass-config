- id: '1618087302165'
  alias: Living Room TV - Set to Soundbar
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.living_room_tv
    attribute: sound_output
    for: 0:00:30
  - platform: state
    entity_id: media_player.living_room_tv
    to: 'on'
  condition:
    condition: not
    conditions:
    - condition: state
      entity_id: media_player.living_room_tv
      state: bt_soundbar
      attribute: sound_output
  action:
  - service: webostv.select_sound_output
    data:
      entity_id: media_player.living_room_tv
      sound_output: external_arc
  mode: single
- id: '1618094589663'
  alias: "\U0001F6E0 Startup Notification"
  trigger:
  - platform: homeassistant
    event: start
  action:
  - service: notify.dans_devices
    data:
      message: "Home Assistant back online! \U0001F389\n"
  mode: single
- id: '1618094617818'
  alias: "\U0001F6E0 Shutdown Notification"
  trigger:
  - platform: homeassistant
    event: shutdown
  action:
  - service: notify.dans_devices
    data:
      message: "Home Assistant is going down! \U0001F44B\n"
  mode: single
- id: '1625482356250'
  alias: Away Mode - Presence Simulation
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.replay_bedroom
    - sensor.replay_dressing_room
    - sensor.replay_bedroom_ensuite
    - sensor.replay_garden
    - sensor.replay_guest_ensuite
    - sensor.replay_entrance_hall
    - sensor.replay_living_room
  condition:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ is_state("sun.sun", "below_horizon") }}'
      - condition: template
        value_template: '{{ trigger.to_state == "on" }} '
      sequence:
      - service: hue.hue_activate_scene
        data:
          group_name: '{{ trigger.entity_id.replace("sensor.replay_","light.") }}'
          scene_name: '{{ states.sensor.day_phase.state }}'
    default:
    - service: light.turn_off
      data:
        entity_id: '{{ trigger.entity_id.replace("sensor.replay_","light.") }}'
  mode: single
- id: '1628502137509'
  alias: "\U0001F3E0 Sleep Mode On"
  description: ''
  trigger:
  - platform: time
    at: '22:00'
  condition: []
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.sleep_mode
    data: {}
  mode: single
- id: '1658090323476'
  alias: "\U0001F6E0 Run Watchman"
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: watchman.report
    data: {}
  mode: single
- id: '1676995186530'
  alias: "\U0001F697 Reconcile Home Charge Limit"
  description: ''
  trigger:
  - platform: time_pattern
    minutes: '5'
  condition:
  - condition: zone
    entity_id: device_tracker.tesla_location_tracker
    zone: zone.home
  action:
  - if:
    - condition: time
      after: 05:30:00
      before: '23:30:00'
      alias: Is Variable Off Peak
    then:
    - condition: not
      conditions:
      - condition: state
        entity_id: number.tesla_charge_limit
        state: '100'
      alias: If Not In Correct State
    - service: number.set_value
      data:
        value: '100'
      target:
        entity_id: number.tesla_charge_limit
    else:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_boolean.tesla_home_reduced_charging
        state: 'on'
      - condition: template
        value_template: '{{ states.number.tesla_charge_limit.state != states.input_number.tesla_home_overnight_charge_limit.state
          }}'
        alias: Not In Correct State
    - service: number.set_value
      data_template:
        entity_id: number.tesla_charge_limit
        value: '{{ states.input_number.tesla_home_overnight_charge_limit.state }}

          '
      target:
        entity_id: number.tesla_charge_limit
  mode: single
- id: '1676996174224'
  alias: "\U0001F697 Auto Reduced Charging"
  description: ''
  trigger:
  - type: plugged_in
    platform: device
    device_id: cbc82858929f108b40302fcc67bcc77d
    entity_id: binary_sensor.tesla_charger
    domain: binary_sensor
  condition:
  - condition: zone
    entity_id: device_tracker.tesla_location_tracker
    zone: zone.home
  action:
  - if:
    - condition: template
      value_template: '{{  (now() - strptime(states.sensor.tesla_full_battery.state,
        ''%Y-%m-%d %H:%M:%S.%f%z'')).days >= 14 }}'
    then:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.tesla_home_reduced_charging
    else:
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: input_boolean.tesla_home_reduced_charging
  mode: single
- id: '1676999116232'
  alias: "\U0001F419 Home Only Smart Charging"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - device_tracker.tesla_location_tracker
  condition:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: device_tracker.tesla_location_tracker
        state: unavailable
      - condition: state
        entity_id: device_tracker.tesla_location_tracker
        state: unknown
      alias: State Unknown
    alias: Not State Unknown
  action:
  - if:
    - condition: zone
      entity_id: device_tracker.tesla_location_tracker
      zone: zone.home
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.octopus_smart_charging
    else:
    - service: switch.turn_off
      data: {}
      target:
        entity_id: switch.octopus_smart_charging
  mode: single
- id: '1677146988940'
  alias: "\U0001F419 Dehumidify Off Peak"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.octopus_intelligent_slot
  - platform: time_pattern
    minutes: '5'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: binary_sensor.octopus_intelligent_slot
      state: 'on'
    then:
    - type: turn_on
      device_id: 8cee0df6b6a02ba0be61b4e9058c7449
      entity_id: switch.dehumidifier
      domain: switch
    else:
    - type: turn_off
      device_id: 8cee0df6b6a02ba0be61b4e9058c7449
      entity_id: switch.dehumidifier
      domain: switch
  mode: single
- id: '1678816456729'
  alias: "\U0001F4A1 Bathroom"
  description: ''
  use_blueprint:
    path: motion_dayphase.yaml
    input:
      motion_entity: binary_sensor.bathroom_sensor_motion
      light_target:
        entity_id: light.bathroom
- id: '1678872073534'
  alias: "\U0001F4A1 Bathroom"
  description: ''
  use_blueprint:
    path: motion_dayphase.yaml
    input:
      motion_entity: binary_sensor.bathroom_sensor_motion
      light_target: light.bathroom
      no_motion_wait: 10
- id: '1678872412394'
  alias: "\U0001F4A1 Toilet"
  description: ''
  use_blueprint:
    path: motion_dayphase.yaml
    input:
      motion_entity: binary_sensor.toilet_sensor_motion
      light_target: light.toilet
- id: '1678899778275'
  alias: "\U0001F4A1 Playroom"
  description: ''
  use_blueprint:
    path: motion_dayphase.yaml
    input:
      motion_entity: binary_sensor.playroom_sensor_motion
      light_target: light.playroom
      no_motion_wait: 10
- id: '1679074324706'
  alias: "\U0001F518 Playroom Button"
  description: ''
  trigger:
  - device_id: a526c8841f0ddce4f0aa71ba6f81dbb7
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
  - device_id: a526c8841f0ddce4f0aa71ba6f81dbb7
    domain: zha
    platform: device
    type: remote_button_long_release
    subtype: dim_up
  action:
  - service: counter.increment
    data: {}
    target:
      entity_id: counter.playroom_button_counter
  - if:
    - condition: template
      value_template: "{{ (states.counter.playroom_button_counter.state | int) > states.scene
        \n | map(attribute=\"entity_id\")\n | select(\"match\", \".*playroom.*\")\n
        | list | length * 2\n}}\n"
    then:
    - service: counter.reset
      data: {}
      target:
        entity_id: counter.playroom_button_counter
    else:
    - service: counter.increment
      data: {}
      target:
        entity_id: counter.playroom_button_counter
  - service: hue.activate_scene
    data: {}
    target:
      entity_id: "{{ (states.scene \n | map(attribute=\"entity_id\")\n | select(\"match\",
        \".*playroom.*\")\n | list)[(states.counter.playroom_button_counter.state
        | int / 2) | int] }}\n"
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: hue.activate_scene
    data:
      transition: 30
    target:
      entity_id: '{{ "scene.playroom_" ~ states.sensor.day_phase.state }}

        '
  mode: single
